<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Syllabus Query Bot</title>
  <link href="https://fonts.googleapis.com/css2?family=Lato&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Lato', sans-serif;
      margin: 2rem;
      min-height: 100vh;
      background: linear-gradient(0deg, #d4b6fb 0%, #ffffff 100%);
    }
    h1, h2 {
      color: #4F2683; /* purple */
    }
    button {
      font-size: 0.9rem;
      font-weight: bold;
      padding: 0.3rem 1.1rem;
      background-color: #7e57c2;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 1rem;
    }
    button:hover {
      background-color: #6a4bb3;
    }
    select {
      font-size: 1.0rem;
      margin-left: 0.5rem;
    }
    textarea {
      font-family: monospace;
      width: 100%;
      max-width: 600px;
    }
    #response {
      white-space: pre-wrap;
      margin-top: 1rem;
      padding: 1rem;
      background: #f4f4f4;
      border: 1px solid #ccc;
      max-width: 600px;
    }
  </style>
</head>
<body>
    <h2>Political Science 1026 Chatbot</h2>
    <h5>***All responses are drawn directly from course materials on the course website: syllabus responses come from the syllabus only, EBO and Essay responses use the EBO and Essay Assignments Info only,
        and midterm and final exam responses use the respective lecture content only.</h5>
    <label for="botMode"><strong>Select a function:</strong></label>
    <select id="botMode">
        <option value="syllabus">Syllabus Questions</option>
        <option value="eboEssay">EBO & Essay Questions</option>
        <option value="midterm">Midterm content</option>
        <option value="final">Final content</option>
    </select>
    <hr />
    <div id="notAvailableMesg" style="display: none;">
        <p><strong>This information is not yet available, please wait for announcements.</strong></p>
    </div>
    <div id="formContainer">
        <form id="queryForm">
            <div id="syllabusInputs">
                <p><strong>Syllabus Query Page</strong></p>
                <label for="syllabusQuestion">Ask a question about the syllabus:</label><br />
                <textarea
                        id="syllabusQuestion"
                        rows="5"
                        placeholder="Type your question here..."
                ></textarea>
            </div>
            <div id="eboEssayInputs" style="display: none;">
                <p><strong>EBO and Essay Query Page</strong></p>
                <label for="eboEssayQuestion">Ask a question about EBO or Essay:</label><br />
                <textarea
                        id="eboEssayQuestion"
                        rows="5"
                        placeholder="Type your question here..."
                ></textarea>
            </div>
            <div id="midtermInputs" style="display: none;">
                <p><strong>Midterm Query Page</strong></p>
                <label for="midtermQuestion">Ask a question about the midterm:</label><br />
                <textarea
                        id="midtermQuestion"
                        rows="5"
                        placeholder="Type your question here..."
                ></textarea>
            </div>
            <div id="finalInputs" style="display: none;">
                <p><strong>Final Exam Query Page</strong></p>
                <label for="finalQuestion">Ask a question about the final exam:</label><br />
                <textarea
                        id="finalQuestion"
                        rows="5"
                        placeholder="Type your question here..."
                ></textarea>
            </div>
            <button type="submit">Submit</button>
        </form>
    </div>
    <h3>Response:</h3>
    <h5> all queries and responses are anonymously recorded by qualitrics for feedback, research and improvement</h5>
    <pre id="response"></pre>
    <script>
    const MIDTERM_LOCKED = false;
    const FINAL_LOCKED = false;

    const botMode = document.getElementById("botMode");
    const syllabusInputs = document.getElementById("syllabusInputs");
    const midtermInputs = document.getElementById("midtermInputs");
    const eboEssayInputs = document.getElementById("eboEssayInputs");
    const finalInputs = document.getElementById("finalInputs");
    const notAvailableMesg = document.getElementById("notAvailableMesg");
    const formContainer = document.getElementById("formContainer");
    const form = document.getElementById("queryForm");
    const responseBox = document.getElementById("response");

    botMode.addEventListener("change", () => {
        notAvailableMesg.style.display = "none";
        formContainer.style.display = "block";
        if (botMode.value === "syllabus") {
            syllabusInputs.style.display = "block";
            finalInputs.style.display = "none";
            midtermInputs.style.display = "none";
            eboEssayInputs.style.display = "none";
        } else if (botMode.value === "eboEssay") {
            syllabusInputs.style.display = "none";
            finalInputs.style.display = "none";
            midtermInputs.style.display = "none";
            eboEssayInputs.style.display = "block";
        } else if (botMode.value === "midterm") {
            syllabusInputs.style.display = "none";
            finalInputs.style.display = "none";
            eboEssayInputs.style.display = "none";
            if(MIDTERM_LOCKED){
                notAvailableMesg.style.display = "block";
                formContainer.style.display = "none";
            } else midtermInputs.style.display = "block";
        } else {
            syllabusInputs.style.display = "none";
            midtermInputs.style.display = "none";
            eboEssayInputs.style.display = "none";
            if(FINAL_LOCKED){
                notAvailableMesg.style.display = "block";
                formContainer.style.display = "none";
            } else finalInputs.style.display = "block";
        }
    });

    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        responseBox.textContent = "Loading...";

        const mode = document.getElementById("botMode").value;
        let payload = { mode };

        if (mode === "syllabus") {
          payload.question = document.getElementById("syllabusQuestion").value;
        }
        if (mode === "eboEssay") {
          payload.question = document.getElementById("eboEssayQuestion").value;
        }
        if (mode === "midterm") {
          payload.question = document.getElementById("midtermQuestion").value;
        }
        if (mode === "final") {
          payload.question = document.getElementById("finalQuestion").value;
        }

        try {
        const res = await fetch("https://1026botall.deno.dev/", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });

        const text = await res.text();
        responseBox.textContent = text;
        } catch (err) {
        responseBox.textContent = "Error contacting server.";
        }
    });


    </script>
</body>
</html>
